<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Indi ComboWorks — 1000 Jobs & Earnings </title>
  <style>
    :root{--bg:#071022;--card:#0b1220;--accent:#ffd166;--muted:#9aa4b2}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Roboto,'Noto Sans',sans-serif;background:linear-gradient(180deg,#021029 0%, #071228 100%);color:#eaf2ff}
    header{display:flex;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.04)}
    .logo{font-weight:900;color:var(--accent);font-size:20px}
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
    input[type=text], input[type=number], input[type=email], textarea, select{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:rgba(255,255,255,.02);color:inherit}
    .summary{padding:10px 18px;display:flex;gap:12px;align-items:center}
    .pill{background:rgba(255,255,255,.02);padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.03);font-size:13px}
    main{padding:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:12px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.01), rgba(255,255,255,.005));padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.03);cursor:pointer;display:flex;flex-direction:column;gap:8px;height:140px}
    .icon{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#6ee7b7);display:flex;align-items:center;justify-content:center;font-weight:700;color:#071022}
    .title{font-weight:800;font-size:14px}
    .meta{font-size:12px;color:var(--muted)}
    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:auto}
    .btn{padding:8px 10px;border-radius:8px;border:0;background:var(--accent);color:#071022;font-weight:700;cursor:pointer}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,.06);color:var(--muted);padding:8px;border-radius:8px;cursor:pointer}
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,.7);display:none;align-items:center;justify-content:center;padding:18px;z-index:80}
    .modal{width:980px;max-width:98%;background:#051226;border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,.04);max-height:90vh;overflow:auto}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .small{flex:0 0 160px}
    footer{padding:12px 18px;color:var(--muted);font-size:13px}
    .admin-panel{position:fixed;right:18px;bottom:18px;z-index:90}
    .panel-btn{padding:12px;border-radius:999px;background:#071428;border:2px solid rgba(255,255,255,.04);color:var(--accent);font-weight:800;cursor:pointer}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.03);text-align:left}
    .small-input{width:100px}
    .note{font-size:12px;color:var(--muted)}
    @media (max-width:900px){.row{flex-direction:column}.small{flex:0 0 auto;width:100%}.card{height:auto}}
  </style>
</head>
<body>
  <header>
    <div class="logo">Indi ComboWorks</div>
    <div style="font-size:13px;opacity:.9">1000 works + Earnings. online lecture through our dashboard.</div>
    <div class="controls">
      <input id="search" type="text" placeholder="Search jobs, subjects, cities... (Press / to focus)" />
      <select id="categoryFilter"><option value="all">All Categories</option></select>
      <button id="reset" class="btn">Reset</button>
    </div>
  </header>

  <div class="summary">
    <div class="pill">Total works: <strong id="total">1057254.00</strong></div>
    <div class="pill">Visible: <strong id="visible">1057254.00</strong></div>
    <div class="pill">Platform Wallet: ₹<strong id="platformWallet">1057254.00 every month</strong></div>
    <div class="pill">Total earnings (workers on Job 13291): ₹<strong id="totalEarnings">18000+ per month per user</strong></div>
  </div>

  <main>
    <div class="grid" id="grid"></div>
  </main>

  <!-- Modal for apply / module -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" role="dialog" aria-modal="true">
      <button id="modalClose" class="ghost" style="float:right">Close ✕</button>
      <h2 id="modalTitle">Apply</h2>
      <div class="row" style="margin-top:8px">
        <div class="small">
          <div id="modalIcon" style="width:140px;height:140px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#6ee7b7);display:flex;align-items:center;justify-content:center;font-weight:900;color:#071022;font-size:28px"></div>
          <div id="modalCategory" style="color:var(--muted);margin-top:8px"></div>
        </div>
        <div class="col">
          <div id="modalDesc" style="color:#dfeaf6;line-height:1.4"></div>

          <div style="margin-top:12px">
            <button id="openModuleBtn" class="btn">Open Module (available after apply)</button>
            <button id="earnBtn" class="ghost"> Earn ₹18000+ per month</button>
            <button id="bookmarkBtn" class="ghost">Bookmark</button>
          </div>

          <hr style="margin:12px 0;border-color:rgba(255,255,255,.03)" />

          <div>
            <div class="note">Apply form below — it posts to <strong>formsubmit.co</strong>. You must verify your email at formsubmit.co to receive applications.</div>
            <form id="applyForm" class="apply-form" method="POST" action="https://formsubmit.co/aaravbretiya@gmail.com" target="_blank">
              <input type="hidden" name="_subject" id="_subject" value="New application">
              <input type="hidden" name="_next" value="https://formsubmit.co/success">

              <label>Full name<input name="name" required /></label>
              <label>Email<input name="email" type="email" name="email" required /></label>
              <label>Phone<input name="phone" type="tel" name="phone" required /></label>
              <label>City<input name="city" name="city"/></label>
              <label>Job Applied<input id="job_applied" name="job_applied" readonly /></label>
              <label>Message<textarea name="message" rows="4"></textarea></label>
              <div style="display:flex;gap:8px;margin-top:8px">
                <button type="submit" class="btn">Submit Application</button>
                <button type="button" id="saveLocal" class="ghost">Save Locally</button>
              </div>
            </form>
            <div id="applyStatus" style="margin-top:8px;color:var(--muted)"></div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Admin floating button -->
  <div class="admin-panel">
    <button id="openAdmin" class="panel-btn">WORK RATES</button>
  </div>

  <!-- Admin Modal -->
  <div class="modal-backdrop" id="adminBackdrop" style="z-index:100">
    <div class="modal" role="dialog" aria-modal="true">
      <button id="adminClose" class="ghost" style="float:right">Close ✕</button>
      <h2>Admin — Earnings & Payouts</h2>
      <div class="row">
        <div class="col" style="max-width:520px">
          <h3>Category Rates </h3>
          <div class="note">Automatically applied platform commission % per category.</div>
          <div id="ratesTable" style="margin-top:8px"></div>

          <h3 style="margin-top:12px"> Transaction</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
            <select id="simCategory"></select>
            <input id="simAmount" type="number" placeholder="Amount (₹)" class="small-input" />
            <button id="simulateBtn" class="btn">Transaction</button>
          </div>
          <div id="simResult" style="margin-top:8px;color:var(--muted)"></div>

          <h3 style="margin-top:12px">Platform Wallet</h3>
          <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
            <div>Balance: ₹<strong id="walletBal">1057254.00</strong></div>
            <button id="exportApps" class="ghost">Export Applications (CSV)</button>
            <button id="exportTx" class="ghost">Export Transactions (CSV)</button>
          </div>
        </div>

        <div class="col">
          <h3>Applications (live)</h3>
          <div id="appsTable" style="max-height:420px;overflow:auto;margin-top:8px"></div>
          <h3 style="margin-top:12px">Recent Transactions</h3>
          <div id="txTable" style="max-height:200px;overflow:auto;margin-top:8px"></div>
        </div>
      </div>

      <hr style="margin:12px 0;border-color:rgba(255,255,255,.03)" />
      <div class="note">Tips: Use 'withdraw' when your account threshold 1000 or more Via Your upi id. System will split worker payout and platform commission and record a transaction.</div>
    </div>
  </div>

  <footer>All Rights Reserved to IndiCombo Works(2025).</footer>

  <script>
    // ---------- data & items generation (same 1000 items) ----------
    const categories = [
      'College & UPSC (Subjects: Physics,Chemistry,Biology,Maths,Hindi,Psychology,Geography,Environment,Yoga,UPSC)',
      'School Teachers (Primary to Senior Secondary)',
      'Tuition & Private Tutors (All Subjects)',
      'Preschool & Early Learning',
      'Test Prep & Competitive Exams (JEE/NEET/SSC/UPSC GLS)',
      'Online Course Creators & Recorded Classes',
      'Special Education & SEN',
      'Language Tutors (English,Hindi,Regional,Chinese,Japanese)',
      'Vocational Training (Carpentry,Electrician,Plumbing)',
      'Skill Development (Coding,Design,Marketing)',

      'Office Admin / HR / Back-office',
      'Remote Data Entry & Virtual Assistants',
      'Finance / Bookkeeping / Accounting',
      'Sales & Telecalling',
      'Customer Support / Call Center',
      'Recruitment / Headhunting',
      'Legal Assistance / Paralegal',
      'Payroll / Tax Assistants',
      'Compliance / Documentation',
      'Quality Assurance / Testing',

      'Video Makers / YouTube Creators',
      'Video Editors / Motion Graphics',
      'Cinematography / Camera Operators',
      'Sound Engineers / Audio Editing',
      'Music Producers / Composers',
      'Lyricists & Songwriters',
      'Singers / Vocalists',
      'Dancers / Choreographers',
      'Actors & Performers',
      'Social Media Influencers / Managers',

      'Web Developers (Frontend/Backend)',
      'Mobile App Developers (Android/iOS)',
      'UI/UX Designers',
      'Graphic Designers / Animators',
      'SEO / SEM / Ads Managers',
      'DevOps / Cloud Engineers',
      'AI / ML / Data Science Gigs',
      'Cybersecurity Basics',
      'SaaS Support / Customer Success',
      'API / Integrations',

      'E-commerce Sellers / Product Listers',
      'Shopkeepers / Retail Staff',
      'Wholesalers / Distributors',
      'Market Stall & Street Vendors',
      'Delivery & Logistics',
      'Inventory / Warehouse Staff',
      'Merchandising / Visual Display',
      'POS / Billing Assistants',
      'Order Fulfillment / Packing',
      'Local Marketplace Managers',

      'Food Sellers / Cloud Kitchen',
      'Home Chefs / Tiffin Services',
      'Bakery / Pastry Helpers',
      'Catering / Event Cooking',
      'Food Photographers / Menu Listing',
      'Nutritionists & Diet Coaches',
      'Food Safety / Hygiene Inspectors',
      'Street Food Vendors',
      'Food Delivery Riders',
      'Restaurant Staff / Hospitality',

      'Gym Trainers / Fitness Instructors',
      'Yoga Instructors / Wellness Coaches',
      'Meditation / Mindfulness Teachers',
      'Physiotherapy Assistants',
      'Zumba / Dance Fitness',
      'Personal Trainers (Home)',
      'Wellness Content Creators',
      'Ayurveda / Traditional Healers',
      'Nutrition Counselors',
      'Health Screening Coordinators',

      'Carpentry / Furniture Makers',
      'Plumbers / Electricians',
      'Painters / Decorators',
      'Masons / Construction Helpers',
      'Home Cleaners / Housekeeping',
      'Pest Control Technicians',
      'Interior Decorators (Consultation)',
      'Modular Kitchen Installers',
      'Appliance Repair Technicians',
      'Gardeners / Landscapers',

      'Drivers (Car/Truck)',
      'Packers & Movers',
      'Logistics Coordinators',
      'Cold-chain / Pharma Logistics',
      'Fleet Maintenance / Mechanics',
      'Warehouse Pickers',
      'Last-mile Aggregators',
      'Courier / Locker Management',
      'Vehicle Detailing',
      'Transport Helpers',

      'Telemedicine / Health Consultants',
      'Nurses / Caregivers',
      'Medical Transcriptionists',
      'Pharmacy Assistants',
      'Mental Health Counsellors',
      'Dental Assistants (Booking)',
      'Physio Home Assist',
      'Lab Sample Coordinators',
      'Health Educators',
      'Community Health Workers',

      'Agriculture / Farm Labour',
      'Dairy / Poultry Helpers',
      'Organic Farming Support',
      'Seed & Input Retail',
      'Rural Surveyors / Mapping',
      'Handicraft / Artisans',
      'Agri-Consultants',
      'Crop Buyers / Aggregators',
      'Fishery / Aquaculture',
      'Dairy Collection Helpers'
    ];

    const items = [];
    function makeVariants(base){
      const modes = ['Online (Part-time)','Online (Full-time)','Offline (Local)','Hybrid','Recorded Course','One-off Gig','Short-term Contract','Long-term','Weekend','Trial/Internship'];
      return modes.map(m=> ({ title: `${base} — ${m}`, category: base, desc: `${base} | Mode: ${m}. Apply now to start earning. Fill the form to send application to email.` }));
    }

    categories.forEach(cat=>{
      if(cat.startsWith('College & UPSC')){
        const collegeWorks = [
          {title:'Assistant Professor — Physics (College - Online)', category:cat, desc:'Physics teaching — college level. Online lectures, lab guidance.'},
          {title:'Assistant Professor — Chemistry (College - Online)', category:cat, desc:'Chemistry teaching — college level. Lab demos and recorded content.'},
          {title:'Assistant Professor — Biology (College - Hybrid)', category:cat, desc:'Biology lectures and practical session coordination.'},
          {title:'Lecturer — Mathematics (College - Offline)', category:cat, desc:'Maths lecturer for college/university.'},
          {title:'Lecturer — Hindi (College - Online)', category:cat, desc:'Hindi literature & language classes.'},
          {title:'Assistant Professor — Psychology (College - Online)', category:cat, desc:'Psychology subject teaching and counseling.'},
          {title:'Lecturer — Geography / Environment (College - Hybrid)', category:cat, desc:'Geography and environmental studies.'},
          {title:'Yoga Instructor — College Health Program (Offline)', category:cat, desc:'Yoga sessions for students.'},
          {title:'UPSC Mentor — Polity & Governance (Coaching)', category:cat, desc:'UPSC polity specialist for mains & prelims.'},
          {title:'UPSC Mentor — History & Current Affairs (Coaching)', category:cat, desc:'UPSC history mentor and current affairs sessions.'}
        ];
        collegeWorks.forEach((w,i)=> items.push(Object.assign({id:`work-college-${i+1}`},w)));
      } else {
        const vs = makeVariants(cat);
        vs.forEach((v,i)=> items.push(Object.assign({id:`work-${items.length+1}`},v)));
      }
    });

    while(items.length < 1000){
      const idx = items.length % categories.length; const base = categories[idx];
      const variantIndex = Math.floor(items.length/ categories.length) % 10;
      const mode = ['Online (Part-time)','Online (Full-time)','Offline (Local)','Hybrid','Recorded Course','One-off Gig','Short-term Contract','Long-term','Weekend','Trial/Internship'][variantIndex];
      items.push({id:`work-${items.length+1}`, title:`${base} — ${mode}`, category: base, desc: `${base} | Mode: ${mode}.`});
    }

    if(items.length>1000) items.length = 1000;

    // ---------- storage keys ----------
    const STORAGE = {
      EARNINGS: 'cw_earnings',
      BOOKMARKS: 'cw_bookmarks',
      APPLICATIONS: 'cw_applications',
      RATES: 'cw_rates',
      TX: 'cw_tx',
      WALLET: 'cw_wallet'
    };

    const earnings = JSON.parse(localStorage.getItem(STORAGE.EARNINGS)||'{}');
    const bookmarks = JSON.parse(localStorage.getItem(STORAGE.BOOKMARKS)||'[]');
    const applicationsLocal = JSON.parse(localStorage.getItem(STORAGE.APPLICATIONS)||'[]');
    const txs = JSON.parse(localStorage.getItem(STORAGE.TX)||'[]');
    const wallet = Number(localStorage.getItem(STORAGE.WALLET)||0);
    let rates = JSON.parse(localStorage.getItem(STORAGE.RATES)||'null');

    // default rates per category (if not present) — workerPay = recommended payout to worker for average job in this category, commissionPct = platform %
    if(!rates){
      rates = {};
      categories.forEach(cat=>{
        rates[cat] = { workerPay: 400, commissionPct: 20 };
      });
      localStorage.setItem(STORAGE.RATES, JSON.stringify(rates));
    }

    function saveAll(){ localStorage.setItem(STORAGE.EARNINGS, JSON.stringify(earnings)); localStorage.setItem(STORAGE.BOOKMARKS, JSON.stringify(bookmarks)); localStorage.setItem(STORAGE.APPLICATIONS, JSON.stringify(applicationsLocal)); localStorage.setItem(STORAGE.TX, JSON.stringify(txs)); localStorage.setItem(STORAGE.WALLET, String(walletVal)); localStorage.setItem(STORAGE.RATES, JSON.stringify(rates)); updateTotals(); }

    // dynamic walletVal variable to manage changes then save
    let walletVal = wallet;

    function updateTotals(){
      const sumEarned = Object.values(earnings).reduce((a,b)=>a+(+b||0),0);
      document.getElementById('totalEarnings').textContent = sumEarned;
      document.getElementById('platformWallet').textContent = walletVal;
      document.getElementById('total').textContent = items.length;
    }
    updateTotals();

    // render grid
    const grid = document.getElementById('grid');
    function makeCard(it){
      const c = document.createElement('div'); c.className='card'; c.tabIndex=0;
      const top = document.createElement('div'); top.style.display='flex'; top.style.alignItems='center'; top.style.gap='10px';
      const icon = document.createElement('div'); icon.className='icon'; icon.textContent = it.id.split('-')[1] || 'CW';
      const t = document.createElement('div'); t.style.flex='1';
      const title = document.createElement('div'); title.className='title'; title.textContent = it.title;
      const meta = document.createElement('div'); meta.className='meta'; meta.textContent = it.category;
      t.appendChild(title); t.appendChild(meta);
      top.appendChild(icon); top.appendChild(t);
      c.appendChild(top);
      const footer = document.createElement('div'); footer.className='footer';
      const left = document.createElement('div'); left.className='meta'; left.textContent = `Earned: ₹${earnings[it.id]||0}`;
      const rightBtn = document.createElement('button'); rightBtn.className='btn'; rightBtn.textContent='Start / Apply';
      rightBtn.onclick = (e)=>{ e.stopPropagation(); openModal(it); };
      c.onclick = ()=> openModal(it);
      footer.appendChild(left); footer.appendChild(rightBtn);
      c.appendChild(footer);
      return c;
    }

    function render(list){ grid.innerHTML=''; const frag=document.createDocumentFragment(); list.forEach(it=> frag.appendChild(makeCard(it))); grid.appendChild(frag); document.getElementById('visible').textContent = list.length; }
    render(items);

    // category filter
    const catSelect = document.getElementById('categoryFilter');
    const uniqueCats = Array.from(new Set(items.map(i=>i.category)));
    uniqueCats.forEach(c=>{ const o=document.createElement('option'); o.value=c; o.textContent=c; catSelect.appendChild(o); });

    const searchInput = document.getElementById('search');
    function applyFilter(){ const q = searchInput.value.trim().toLowerCase(); const cat = catSelect.value; const filtered = items.filter(it=>{ const matchQ = (!q) || it.title.toLowerCase().includes(q) || it.desc.toLowerCase().includes(q) || it.category.toLowerCase().includes(q); const matchCat = (cat==='all') || it.category===cat; return matchQ && matchCat; }); render(filtered); }
    searchInput.addEventListener('input', applyFilter); catSelect.addEventListener('change', applyFilter); document.getElementById('reset').addEventListener('click', ()=>{ searchInput.value=''; catSelect.value='all'; applyFilter(); });

    // modal controls
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');
    const modalCategory = document.getElementById('modalCategory');
    const modalIcon = document.getElementById('modalIcon');
    const openModuleBtn = document.getElementById('openModuleBtn');
    const earnBtn = document.getElementById('earnBtn');
    const bookmarkBtn = document.getElementById('bookmarkBtn');
    const applyForm = document.getElementById('applyForm');
    const jobAppliedInput = document.getElementById('job_applied');
    const subjectField = document.getElementById('_subject');
    const applyStatus = document.getElementById('applyStatus');
    const saveLocalBtn = document.getElementById('saveLocal');
    let currentItem = null;

    function openModal(it){ currentItem = it; modalTitle.textContent = it.title; modalDesc.textContent = it.desc; modalCategory.textContent = it.category; modalIcon.textContent = it.id.split('-')[1] || 'CW'; jobAppliedInput.value = it.title; subjectField.value = 'New application: ' + it.title; applyStatus.textContent=''; modalBackdrop.style.display='flex'; }
    document.getElementById('modalClose').onclick = ()=>{ modalBackdrop.style.display='none'; currentItem=null; }
    modalBackdrop.onclick = (e)=>{ if(e.target===modalBackdrop){ modalBackdrop.style.display='none'; currentItem=null; } }

    earnBtn.onclick = ()=>{ if(!currentItem) return; earnings[currentItem.id] = (earnings[currentItem.id]||0) + 5; localStorage.setItem(STORAGE.EARNINGS, JSON.stringify(earnings)); applyFilter(); alert('Simulated ₹5 added to this work.'); }
    bookmarkBtn.onclick = ()=>{ if(!currentItem) return; if(!bookmarks.includes(currentItem.id)){ bookmarks.push(currentItem.id); localStorage.setItem(STORAGE.BOOKMARKS, JSON.stringify(bookmarks)); alert('Bookmarked'); } else alert('Already bookmarked'); }

    saveLocalBtn.onclick = ()=>{
      const formData = new FormData(applyForm);
      const record = {};
      formData.forEach((v,k)=> record[k]=v);
      record._time = new Date().toISOString();
      record.jobId = currentItem ? currentItem.id : 'unknown';
      applicationsLocal.push(record); localStorage.setItem(STORAGE.APPLICATIONS, JSON.stringify(applicationsLocal)); applyStatus.textContent = 'Application saved locally. Also click Submit to send via email (formsubmit.co).';
    };

    applyForm.addEventListener('submit',(e)=>{
      const formData = new FormData(applyForm); const record = {}; formData.forEach((v,k)=> record[k]=v); record._time = new Date().toISOString(); record.jobId = currentItem ? currentItem.id : 'unknown'; applicationsLocal.push(record); localStorage.setItem(STORAGE.APPLICATIONS, JSON.stringify(applicationsLocal)); applyStatus.textContent = 'Application recorded locally. Form will open in new tab for sending to email.';
    });

    // ---------------- Admin panel logic ----------------
    const adminBtn = document.getElementById('openAdmin');
    const adminBackdrop = document.getElementById('adminBackdrop');
    const adminClose = document.getElementById('adminClose');
    adminBtn.onclick = ()=>{ buildAdmin(); adminBackdrop.style.display='flex'; };
    adminClose.onclick = ()=> adminBackdrop.style.display='none';

    function buildAdmin(){
      // rates table
      const ratesDiv = document.getElementById('ratesTable'); ratesDiv.innerHTML='';
      const table = document.createElement('table'); const thead = document.createElement('thead'); thead.innerHTML = '<tr><th>Category</th><th>Worker pay (₹)</th><th>Commission %</th></tr>'; table.appendChild(thead);
      const tbody = document.createElement('tbody');
      Object.keys(rates).forEach(cat=>{
        const tr = document.createElement('tr');
        const td1 = document.createElement('td'); td1.textContent = cat;
        const td2 = document.createElement('td'); const wInp = document.createElement('input'); wInp.type='number'; wInp.value = rates[cat].workerPay; wInp.className='small-input'; td2.appendChild(wInp);
        const td3 = document.createElement('td'); const cInp = document.createElement('input'); cInp.type='number'; cInp.value = rates[cat].commissionPct; cInp.className='small-input'; td3.appendChild(cInp);
        wInp.onchange = ()=>{ rates[cat].workerPay = Number(wInp.value); localStorage.setItem(STORAGE.RATES, JSON.stringify(rates)); };
        cInp.onchange = ()=>{ rates[cat].commissionPct = Number(cInp.value); localStorage.setItem(STORAGE.RATES, JSON.stringify(rates)); };
        tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3); tbody.appendChild(tr);
      });
      table.appendChild(tbody); ratesDiv.appendChild(table);

      // populate simCategory
      const simCat = document.getElementById('simCategory'); simCat.innerHTML=''; Object.keys(rates).forEach(cat=>{ const o=document.createElement('option'); o.value=cat; o.textContent=cat; simCat.appendChild(o); });

      // apps table
      const appsDiv = document.getElementById('appsTable'); appsDiv.innerHTML=''; if(applicationsLocal.length===0) appsDiv.innerHTML='<div class="note">No local applications yet.</div>';
      else{
        const ta = document.createElement('table'); const tb = document.createElement('tbody'); ta.appendChild(tb);
        applicationsLocal.slice().reverse().forEach(app=>{
          const tr = document.createElement('tr'); const td = document.createElement('td'); td.innerHTML = `<strong>${app.name||'--'}</strong><div class='note'>${app.email||''} | ${app.phone||''} | ${app.city||''}</div><div class='note'>Applied: ${app.job_applied||app.job||''} <br/>Time: ${app._time}</div>`; tr.appendChild(td); tb.appendChild(tr);
        }); appsDiv.appendChild(ta);
      }

      // transactions table
      const txDiv = document.getElementById('txTable'); txDiv.innerHTML=''; if(txs.length===0) txDiv.innerHTML='<div class="note">No transactions yet.</div>';
      else{
        const ttab = document.createElement('table'); const tbd = document.createElement('tbody'); ttab.appendChild(tbd);
        txs.slice().reverse().forEach(tx=>{ const tr = document.createElement('tr'); const td = document.createElement('td'); td.innerHTML = `<strong>₹${tx.amount}</strong> | <span class='note'>Platform: ₹${tx.platformCommission} | Worker: ₹${tx.workerPayout} | Cat: ${tx.category} | ${tx.time}</span>`; tr.appendChild(td); tbd.appendChild(tr); }); txDiv.appendChild(ttab);
      }

      document.getElementById('walletBal').textContent = walletVal;
    }

    document.getElementById('simulateBtn').onclick = ()=>{
      const cat = document.getElementById('simCategory').value; let amt = Number(document.getElementById('simAmount').value);
      if(!cat || !amt || amt<=0){ alert('Select category and enter a valid amount'); return; }
      const r = rates[cat] || {workerPay: Math.round(amt*0.8), commissionPct:20};
      const commission = Math.round((r.commissionPct/100)*amt);
      const workerPayout = amt - commission;
      // record tx: platform earns commission, worker gets payout (we simulate platform wallet increase by commission)
      walletVal += commission; localStorage.setItem(STORAGE.WALLET, String(walletVal));
      const tx = { amount: amt, platformCommission: commission, workerPayout: workerPayout, category: cat, time: new Date().toISOString() };
      txs.push(tx); localStorage.setItem(STORAGE.TX, JSON.stringify(txs));
      // update earnings for a sample work (we'll credit first work in category)
      const sampleWork = items.find(it=>it.category===cat);
      if(sampleWork){ earnings[sampleWork.id] = (earnings[sampleWork.id]||0) + workerPayout; localStorage.setItem(STORAGE.EARNINGS, JSON.stringify(earnings)); }
      updateTotals(); buildAdmin(); alert('Transaction recorded,You received your Payments in few hours after a email or Upi id verified. Platform commission: ₹'+commission+' | Worker payout: ₹'+workerPayout);
    };

    document.getElementById('exportApps').onclick = ()=>{ exportCSV(applicationsLocal, 'combo_applications.csv'); };
    document.getElementById('exportTx').onclick = ()=>{ exportCSV(txs, 'combo_transactions.csv'); };

    function exportCSV(arr, filename){ if(!arr || arr.length===0){ alert('No data to export'); return; } const keys = Object.keys(arr[0]); const csv = [keys.join(',')].concat(arr.map(r=> keys.map(k=> '"'+String(r[k]||'').replace(/"/g,'""')+'"').join(','))).join('\n'); const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; a.click(); URL.revokeObjectURL(url); }

    // keyboard shortcuts
    document.addEventListener('keydown',(e)=>{ if(e.key==='/' ){ e.preventDefault(); searchInput.focus(); } if(e.key==='Escape'){ modalBackdrop.style.display='none'; adminBackdrop.style.display='none'; } });

    console.log('ComboWorks with Admin Earnings Dashboard loaded. Open ADMIN button bottom-right. All data saved locally in localStorage.');
  </script>
</body>
</html>